    /**
     * Easily create a mock of any service in the DI container.
     *
     * @param string $id
     * @param array $mockedMethodNames
     * @return \PHPUnit_Framework_MockObject_MockObject
     */
    protected function getServiceMock($id, $mockedMethodNames = array())
    {
        $definition = $this->getContainer()->getDefinition($id);
        $argumentArray = $this->resolveArguments($definition->getArguments());

        // Create the mock.
        $mock = $this->getMock(
            $definition->getClass(),
            $mockedMethodNames,
            $argumentArray
        );

        // Call all of the functions which were requested at instantiation time.
        foreach ($definition->getMethodCalls() as $thisMethodCall) {
            $methodName = $thisMethodCall[0];
            $argumentDefinitions = $thisMethodCall[1];
            $argumentArray = $this->resolveArguments($argumentDefinitions);

            call_user_func_array(
                array(
                    $mock,
                    $methodName,
                ),
                $argumentArray
            );
        }
        return $mock;
    }